name: ğŸš¨ Hotfix Fast-track

on:
  pull_request:
    types:
      - labeled
      - unlabeled

## Secrets
#
# SLACK_HOTFIX_NOTIFICATION_CHANNEL
# SLACK_HOTFIX_NOTIFICATION_WEBHOOK

jobs:
  revoke:
    runs-on: ubuntu-latest
    if: github.event.action == 'unlabeled' && github.event.label.name == 'hotfix ğŸš¨'
    steps:
      - name: Revoke pull request
        uses: andrewmusgrave/automatic-pull-request-review@0.0.5
        with:
          repo-token: ${{ github.token }}
          event: REQUEST_CHANGES
          body: |
            ## ğŸš¨ REVOKE Hotfix Fast-tract

            PR ${{ github.event.pull_request.number }} ì˜ ìë™ ë¦¬ë·°ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
            í•´ë‹¹ ì‚¬í•­ì€ Label ì´ ì œê±°ë˜ì–´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¦¬ë·°ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”

  approve:
    runs-on: ubuntu-latest
    if: github.event.action == 'labeled' && github.event.label.name == 'hotfix ğŸš¨'
    steps:
      - name: Approve pull request
        uses: andrewmusgrave/automatic-pull-request-review@0.0.5
        with:
          repo-token: ${{ github.token }}
          event: APPROVE
          body: |
            ## ğŸš¨ Hotfix Fast-tract (Auto Review)

            PR ${{ github.event.pull_request.number }} ì— ëŒ€í•œ ë¦¬ë·°ê°€ ìë™ìœ¼ë¡œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.
            ìš”ì²­ì— ë”°ë¼, ì´ PRì€ ì½”ë“œ ê²€ì¦ì„ í†µê³¼í•˜ëŠ” ì¦‰ì‹œ Mergeê°€ ê°€ëŠ¥í•˜ë„ë¡ ìë™ìœ¼ë¡œ ë¦¬ë·°ë˜ì—ˆìŠµë‹ˆë‹¤.
            ê´€ë ¨ ì‚¬í•­ì— ëŒ€í•˜ì—¬ Slack Notification ì„ ì œê³µí•˜ì˜€ìœ¼ë‹ˆ, í•´ë‹¹ ì‚¬í•­ì— ëŒ€í•´ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

      - name: Notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_CHANNEL: ${{ secrets.SLACK_HOTFIX_NOTIFICATION_CHANNEL }}
          SLACK_COLOR: '#f85252'
          SLACK_ICON_EMOJI: ':fearful:'
          SLACK_MESSAGE: 'Pull request ${{ github.event.pull_request.number }} - (${{ github.event.pull_request.title }}) ì— ëŒ€í•˜ì—¬ Hotfix Fast-track ì´ ì ìš©ë˜ì–´ ìë™ìœ¼ë¡œ ë¦¬ë·°ë˜ì—ˆìŠµë‹ˆë‹¤.'
          SLACK_TITLE: Hotfix Fast-track(${{ github.repository }}/${{ github.event.pull_request.number }})
          SLACK_USERNAME: 'Git - Hotfix Alert'
          SLACK_WEBHOOK: ${{ secrets.SLACK_HOTFIX_NOTIFICATION_WEBHOOK }}
          MSG_MINIMAL: true
          SLACK_FOOTER: 'https://github.com/${{ github.repository }}/pull/${{ github.event.pull_request.number }}'
