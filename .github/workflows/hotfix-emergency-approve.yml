name: ğŸš¨ Hotfix Fast-track

on:
  workflow_call:

jobs:
  approve:
    runs-on: ubuntu-latest
    if: ${{ contains(github.event.pull_request.labels.*.name, 'hotfix ğŸš¨') }}
    steps:
      - name: Approve pull request
        uses: andrewmusgrave/automatic-pull-request-review@0.0.5
        with:
          repo-token: ${{ github.token }}
          event: APPROVE
          body: |
            ## ğŸš¨ Hotfix Fast-tract (Auto Review)

            PR ${{ github.event.pull_request.number }} ì— ëŒ€í•œ ë¦¬ë·°ê°€ ìë™ìœ¼ë¡œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.

      - name: Cancel check workflows (gradle)
        continue-on-error: true
        with:
          workflow_id: 'check-gradle.yml'
          access_token: ${{ github.token }}

      - name: Cancel check workflows (yarn)
        continue-on-error: true
        with:
          workflow_id: 'check-yarn.yml'
          access_token: ${{ github.token }}

      - name: Notification
        uses: slackapi/slack-github-action@v1.16.0
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_HOTFIX_NOTIFICATION_WEBHOOK }}
          SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
        with:
          payload: '{"blocks":[{"type":"section","text":{"type":"mrkdwn","text":"*ğŸš¨ @channel í•«í”½ìŠ¤ê°€ ë°œìƒí•˜ì—¬ ë¦¬ë·°ë˜ì—ˆìŠµë‹ˆë‹¤.*"}},{"type":"section","text":{"type":"mrkdwn","text":"```\nRepository: ${{ github.repository }} \nPR: ${{ github.event.pull_request.number }}\nTitle: ${{ github.event.pull_request.title }}```"}},{"type":"context","elements":[{"type":"mrkdwn","text":"*${{ github.actor }}* ë‹˜ì´ ì‹¤í–‰í•˜ê±°ë‚˜ ì‘ì—…í•˜ì˜€ìŠµë‹ˆë‹¤."}]},{"type":"context","elements":[{"type":"mrkdwn","text":"${{ github.server_url }}/${{ github.repository }}/pull/${{ github.event.pull_request.number }}"}]}]}'
