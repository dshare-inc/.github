name: ğŸš¨ Hotfix Fast-track

on:
  workflow_call:

jobs:
  revoke:
    name: Revoke the review
    runs-on: ubuntu-latest
    if: ${{  github.event.action == 'unlabeled' && github.event.label.name == 'hotfix ğŸš¨' }}
    steps:
      - name: Revoke pull request
        uses: andrewmusgrave/automatic-pull-request-review@0.1.0
        with:
          repo-token: ${{ github.token }}
          event: DISMISS
          body: "ğŸ˜§ Hotfix fast-track Revoked"

      - name: Notification
        uses: slackapi/slack-github-action@v1.16.0
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_HOTFIX_NOTIFICATION_WEBHOOK }}
          SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
        with:
          payload: '{"blocks":[{"type":"section","text":{"type":"mrkdwn","text":"*ğŸ˜§ í•«í”½ìŠ¤ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.*"}},{"type":"section","text":{"type":"mrkdwn","text":"```\nRepository: ${{ github.repository }} \nPR: ${{ github.event.pull_request.number }}\nTitle: ${{ github.event.pull_request.title }}```"}},{"type":"context","elements":[{"type":"mrkdwn","text":"*${{ github.actor }}* ë‹˜ì´ ì‹¤í–‰í•˜ê±°ë‚˜ ì‘ì—…í•˜ì˜€ìŠµë‹ˆë‹¤."}]},{"type":"context","elements":[{"type":"mrkdwn","text":"${{ github.server_url }}/${{ github.repository }}/pull/${{ github.event.pull_request.number }}"}]}]}'

  approve:
    name: Approve the PR
    runs-on: ubuntu-latest
    if: ${{ contains(github.event.pull_request.labels.*.name, 'hotfix ğŸš¨') }}
    steps:
      - name: Approve pull request
        uses: andrewmusgrave/automatic-pull-request-review@0.1.0
        with:
          repo-token: ${{ github.token }}
          event: APPROVE

      - name: Notification
        uses: slackapi/slack-github-action@v1.16.0
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_HOTFIX_NOTIFICATION_WEBHOOK }}
          SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
        with:
          payload: '{"blocks":[{"type":"section","text":{"type":"mrkdwn","text":"*ğŸš¨ @channel í•«í”½ìŠ¤ê°€ ë°œìƒí•˜ì—¬ ë¦¬ë·°ë˜ì—ˆìŠµë‹ˆë‹¤.*"}},{"type":"section","text":{"type":"mrkdwn","text":"```\nRepository: ${{ github.repository }} \nPR: ${{ github.event.pull_request.number }}\nTitle: ${{ github.event.pull_request.title }}```"}},{"type":"context","elements":[{"type":"mrkdwn","text":"*${{ github.actor }}* ë‹˜ì´ ì‹¤í–‰í•˜ê±°ë‚˜ ì‘ì—…í•˜ì˜€ìŠµë‹ˆë‹¤."}]},{"type":"context","elements":[{"type":"mrkdwn","text":"${{ github.server_url }}/${{ github.repository }}/pull/${{ github.event.pull_request.number }}"}]}]}'
